<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>audio guide prototype</title>
    <link rel="stylesheet" href="static/style/index.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    </head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.39/build/Tone.js"></script>
    <script src="static/js/playFiles1.js"></script> <!-- playFiles1.js -->
    <script src="static/js/gpsTracker.js"></script> <!-- gpsTracker.js -->
    </head>
<body>

    <!-- main script -->
    <script>

    window.preloadedAudio = {}; // make it globally accessible
    let preloadingComplete = false; // flag for preloading status

    const audioFiles = [
        "static/audio/track1.mp3",
        "static/audio/track2.mp3",
        "static/audio/track3.mp3",
        "static/audio/track4.mp3",
        "static/audio/track5.mp3",
        "static/audio/track6.mp3",
        "static/audio/background1.mp3",
        "static/audio/background2.mp3",
        "static/audio/background3.mp3",
        "static/audio/background4.mp3"
    ];

    // function to preload the audio files using Tone.js
    function preloadAudio() {
        let loadedCount = 0;
        audioFiles.forEach(file => {
            const player = new Tone.Player({
                url: file,
                autostart: false,
                onload: () => {
                    console.log(`${file} preloaded.`);
                    loadedCount++;
                    if (loadedCount === audioFiles.length) {
                        preloadingComplete = true; // set flag to true when all files are loaded
                        console.log("All audio files preloaded.");
                    }
                },
                onerror: (error) => {
                    console.error(`Error preloading ${file}:`, error);
                }
            }).toDestination();

            window.preloadedAudio[file] = player; // store in global object
        });
    }

    // call preloadAudio on page load
    document.addEventListener('DOMContentLoaded', function () {
        preloadAudio();
    });

</script>

    <!-- preload icon -->
    <div id="preloadIconContainer">
        <button id="preloadIcon">
            <img src="static/images/preload.png" alt="Preload Icon" class="preload-image">
            preload
        </button>
    </div>  

    <!-- navigation buttons to groups' pages -->
    <!-- change the group name to desired location name -->
    <!-- change the image to desired image -->
    <div id="navigation">
        <a href="group1.html" class="group-link">
            <div class="group-container">
                <img src="static/images/image1.png" alt="group 1 image" class="group-image">
                <div class="group-content">group 1</div>
            </div>
        </a>
        <a href="group2.html" class="group-link">
            <div class="group-container">
                <img src="static/images/image2.png" alt="group 2 image" class="group-image">
                <div class="group-content">group 2</div>
            </div>
        </a>
        <a href="group3.html" class="group-link">
            <div class="group-container">
                <img src="static/images/image3.png" alt="group 3 image" class="group-image">
                <div class="group-content">group 3</div>
            </div>
        </a>
        <a href="group4.html" class="group-link">
            <div class="group-container">
                <img src="static/images/image4.png" alt="group 4 image" class="group-image">
                <div class="group-content">group 4</div>
            </div>
        </a>
    </div>
    

    <footer class="body-foot">
        <div class="foot-bottom">
            &copy; Sound Studies Group, SUSTech, 2024
        </div>
    </footer>    
</body>
</html>
